<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="res/css/bootstrap.css">
    <link rel="stylesheet" href="res/css/main.css">
    <link rel="shortcut icon" href="res/icons/bugcat_logo_256.png" type="image/x-icon">
    <title>MChat</title>
</head>

<body>
    <div id="all_chats">

    </div>
    <div>
        <input type="text" id="msg"><button onclick="sendMsg()">Send</button> <br><br>
        <input type="text" id="newChat"><button onclick="newChat()">New Chat</button>
    </div>
    <script src="res/js/jquery.js"></script>
    <script src="res/js/view.js"></script>
    <script>
        const url = "http://app.bugcatstudio.ga_/mchat/chats.php";
        const user = "munish";
        function all_c() {
            $.ajax({
                type: "POST",
                url: url,
                data: { user: user, all_chats: 0 },
                success: function (e) {
                    $('#all_chats').html(e);
                },
                error: function (e) {
                    $('#all_chats').html(e.statusText);
                }
            });
        }
        all_c();
        function chat(u) {
            $.ajax({
                type: "POST",
                url: url,
                data: { user: user, user2: u, chat: 0 },
                success: function (e) {
                    $('#all_chats').html(e);
                },
                error: function (e) {
                    $('#all_chats').html(e.statusText);
                }
            });
        }
        function sendMsg() {
            var user2 = $('#user2').val();
            var msg = $('#msg').val();
            $.ajax({
                type: "POST",
                url: url,
                data: { user: user, user2: user2, msg: msg, sendMsg: 0 },
                success: function () {
                    chat(user2);
                    $('#msg').val("");
                },
                error: function (e) {
                    $('#all_chats').html(e.statusText);
                }
            });
        }
        function newChat() {
            if ($('#newChat').val() == user)
                alert('Pagal Hai');
            else
                $('#all_chats').html("<input id=\"user2\" value=\"" + $('#newChat').val() + "\" hidden>");
        }
        setInterval(() => {
            if ($('#user2').val() != null) {
                chat($("#user2").val());
            } else {
                all_c();
            }
        }, 3000);
    </script>
</body>

</html>